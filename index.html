<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SoP">
  <meta name="theme-color" content="#000000">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <title>Signs of Presence</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<canvas id="main"></canvas>

<!-- Top bar: stylus HUD -->
<div id="top-bar">
  <div class="hud-item hud-title">Signs of Presence</div>
  <div class="hud-item"><span class="hl">type</span><span class="hv" id="s-type">--</span></div>
  <div class="hud-item"><span class="hl">pressure</span><span class="hv" id="s-pressure">--</span><span class="hbar"><span class="hbar-fill" id="s-pbar" style="width:0%"></span></span></div>
  <div class="hud-item"><span class="hl">tiltX</span><span class="hv" id="s-tiltx">--</span></div>
  <div class="hud-item"><span class="hl">tiltY</span><span class="hv" id="s-tilty">--</span></div>
  <div class="hud-item"><span class="hl">pos</span><span class="hv" id="s-pos">--</span></div>
  <div class="hud-item"><span class="hl">v</span><span class="hv" id="s-version"></span></div>
</div>

<!-- Sidebar: controls -->
<div id="sidebar">
  <div class="brush-types">
    <button class="bt-btn active" data-type="normal">Ink</button>
    <button class="bt-btn" data-type="splatter">Splat</button>
    <button class="bt-btn" data-type="particle">Spray</button>
  </div>
  <button id="btn-brush-panel">&#9998;</button>
  <button class="bt-btn" id="btn-random">Rnd</button>
  <button class="bt-btn" id="btn-default">Def</button>
  <div class="slider-row">
    <div class="vslider" id="vs-size">
      <div class="vslider-fill" id="vsf-size"></div>
      <div class="vslider-label">Size</div>
    </div>
    <div class="vslider" id="vs-speed">
      <div class="vslider-fill" id="vsf-speed"></div>
      <div class="vslider-label">Speed</div>
    </div>
    <div class="vslider" id="vs-lines">
      <div class="vslider-fill" id="vsf-lines"></div>
      <div class="vslider-label">Lines</div>
    </div>
  </div>
  <div id="brush-preview"><div id="brush-dot"></div></div>
  <button class="bt-btn" id="btn-pause">Pause</button>
  <div class="btn-group">
    <button class="bt-btn" id="btn-mirror">Mirror</button>
    <button class="bt-btn" id="btn-drift">Drift</button>
  </div>
  <div class="btn-group">
    <button class="bt-btn" id="btn-flow">Flow</button>
    <button class="bt-btn" id="btn-bleed">Bleed</button>
  </div>
  <div class="btn-group">
    <button class="bt-btn" id="btn-grow">Grow</button>
    <button class="bt-btn" id="btn-flock">Flock</button>
  </div>
  <button class="bt-btn" id="btn-clear">Clear</button>
  <button class="bt-btn" id="btn-reload" onclick="location.reload(true)">Reload</button>
</div>

<!-- Brush settings panel -->
<div id="brush-panel">
  <div class="bp-header">Brush <button class="bp-close" id="bp-close">&times;</button></div>
  <div class="bp-row"><label>Smoothing</label><input type="range" id="bp-stream" min="0" max="95" value="60"><span class="bp-val" id="bpv-stream">60</span></div>
  <div class="bp-row"><label>Curve Bias</label><input type="range" id="bp-curve" min="0" max="100" value="80"><span class="bp-val" id="bpv-curve">50</span></div>
  <div class="bp-row"><label>Press Curve</label><input type="range" id="bp-pcurve" min="30" max="300" value="70"><span class="bp-val" id="bpv-pcurve">70</span></div>
  <div class="bp-row"><label>Press &rarr; Size</label><input type="range" id="bp-psize" min="0" max="100" value="100"><span class="bp-val" id="bpv-psize">100</span></div>
  <div class="bp-row"><label>Press &rarr; Opac</label><input type="range" id="bp-popac" min="0" max="100" value="0"><span class="bp-val" id="bpv-popac">15</span></div>
  <div class="bp-row"><label>Speed Thin</label><input type="range" id="bp-vel" min="0" max="100" value="30"><span class="bp-val" id="bpv-vel">30</span></div>
  <div class="bp-row"><label>Min Size</label><input type="range" id="bp-min" min="1" max="50" value="1"><span class="bp-val" id="bpv-min">1</span></div>
  <div class="bp-row"><label>Softness</label><input type="range" id="bp-soft" min="0" max="100" value="15"><span class="bp-val" id="bpv-soft">15</span></div>
  <div class="bp-row"><label>Tilt &rarr; Shape</label><input type="range" id="bp-tilt" min="0" max="100" value="70"><span class="bp-val" id="bpv-tilt">70</span></div>
  <div class="bp-row"><label>Taper</label><input type="range" id="bp-taper" min="0" max="100" value="20"><span class="bp-val" id="bpv-taper">20</span></div>
  <div class="bp-row"><label>Tremor</label><input type="range" id="bp-tremor" min="0" max="100" value="0"><span class="bp-val" id="bpv-tremor">0</span></div>
  <div class="bp-row"><label>Inertia</label><input type="range" id="bp-inertia" min="0" max="100" value="20"><span class="bp-val" id="bpv-inertia">20</span></div>
  <div class="bp-row"><label>Scatter</label><input type="range" id="bp-scatter" min="0" max="100" value="0"><span class="bp-val" id="bpv-scatter">0</span></div>
  <div class="bp-row"><label>Scatter Dens</label><input type="range" id="bp-sdens" min="1" max="12" value="4"><span class="bp-val" id="bpv-sdens">4</span></div>
</div>

<script src="js/app.js"></script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations().then(regs => {
    regs.forEach(r => r.unregister());
  });
  caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
}
// Block iOS/iPadOS system gestures on canvas only
const cvs = document.getElementById('main');
['gesturestart','gesturechange','gestureend','contextmenu','selectstart',
 'dragstart','copy','dblclick','touchforcechange'].forEach(evt => {
  cvs.addEventListener(evt, e => e.preventDefault(), { passive: false });
});
// Block ALL zoom: pinch, double-tap, gesture zoom
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('gesturestart', e => e.preventDefault());
document.addEventListener('gesturechange', e => e.preventDefault());
document.addEventListener('gestureend', e => e.preventDefault());
// Block double-tap zoom on the whole page
let lastTap = 0;
document.addEventListener('touchend', e => {
  const now = Date.now();
  if (now - lastTap < 300) e.preventDefault();
  lastTap = now;
}, { passive: false });
// Block pinch zoom via touch
document.addEventListener('touchmove', e => {
  if (e.touches.length > 1) e.preventDefault();
}, { passive: false });
</script>
</body>
</html>
